name: 'Dispatch Game Update'
description: 'Dispatches game_version_update event to configured repositories'

inputs:
  token:
    description: 'GitHub token with repo access'
    required: true
  event-type:
    description: 'The event type to dispatch'
    required: false
    default: 'game_version_update'

runs:
  using: 'composite'
  steps:
    - name: Dispatch to repositories
      shell: pwsh
      env:
        GH_TOKEN: ${{ inputs.token }}
      run: |
        $repos = @(
          "BUTR/Bannerlord.ReferenceAssemblies.Documentation",
          "BUTR/Bannerlord.Harmony",
          "BUTR/Bannerlord.UIExtenderEx",
          "BUTR/Bannerlord.ButterLib",
          "Aragas/Bannerlord.MBOptionScreen",
          "BUTR/Bannerlord.BLSE",
          "BUTR/Bannerlord.BUTRLoader",
          "BUTR/Bannerlord.BUTR.Shared",
          "BUTR/Bannerlord.Python",
          "BUTR/Bannerlord.PHP",
          "BUTR/Bannerlord.DiscordRichPresence",
          "BUTR/Bannerlord.PlayerSwitcher",
          "BUTR/Bannerlord.YellToInspire",
          "BUTR/Bannerlord.Game.Diff"
        )

        foreach ($repo in $repos) {
          Write-Host "Dispatching ${{ inputs.event-type }} to $repo"
          gh api repos/$repo/dispatches -f event_type=${{ inputs.event-type }}
        }
